# データフェッチ戦略の改善

## 背景

- `CLAUDE.md` にガイダンスを記載した
- `docs/requirements.md` に要件を定義した
- ページコンポーネントのトップレベルでデータフェッチを行っているため、First Contentful Paint (FCP) が遅い

## タスク

- Server Components を利用して、コンポーネントごとに非同期でデータフェッチを行う

## 実装完了

### 高優先度ページの最適化
✅ **`/teams/page.tsx`**
- チーム一覧データフェッチを `TeamsList` コンポーネントに分離
- Suspense境界を追加してスケルトンローディングを実装
- ページヘッダーとCTAボタンは即座に表示される

✅ **`/notifications/page.tsx`** 
- 通知データとユーザー設定データの並列フェッチを `NotificationsContent` コンポーネントに分離
- Suspense境界を追加してスケルトンローディングを実装
- ページタイトルエリアは即座に表示される

✅ **`/teams/[teamId]/okrs/page.tsx`**
- OKR一覧データフェッチを `OkrsList` コンポーネントに分離
- Suspense境界を追加してスケルトンローディングを実装
- ページヘッダーとフィルター機能は即座に表示される

### パフォーマンス改善効果

**改善前:**
- ページ全体がデータ取得完了まで白い画面で待機
- チーム一覧、通知、OKR一覧などの大きなデータセットで特に遅延が発生

**改善後:**
- ページの基本構造（ヘッダー、ナビゲーション、フィルター等）が即座に表示
- データ取得中はスケルトンローディングで適切なフィードバック
- 複数のデータソースがある場合も並列処理で効率化
- First Contentful Paint (FCP) の大幅な向上

### 実装パターン

各ページで以下のパターンを採用:

1. **メインページコンポーネント**: 即座に表示可能な要素のみをレンダリング
2. **データフェッチコンポーネント**: async/awaitでデータ取得を行う
3. **Suspense境界**: スケルトンローディングでUX向上
4. **スケルトンコンポーネント**: 実際のコンテンツと同じ構造でローディング状態を表現

これにより、ユーザーはページの読み込み開始を即座に感じることができ、パフォーマンスが大幅に改善されています。
